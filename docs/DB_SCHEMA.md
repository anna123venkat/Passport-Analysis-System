#  Database Schema - Passport Analytical System

This document provides the **MongoDB database schema** for the project, including **collections, fields, and sample queries**.

---

##  Collections

The database consists of the following collections:

1. **users** - Stores user details (clients and admins).
2. **passports** - Stores passport-related information.
3. **logins** - Stores authentication credentials.

---

## 1️ **Users Collection**

###  Schema Definition

```javascript
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
    first_name: { type: String, required: true },
    last_name: { type: String, required: true },
    email: { type: String, required: true, unique: true },
    mobile: { type: Number, required: true },
    dob: { type: Date, required: true },
    age: { type: Number, required: true },
    gender: { type: String, enum: ["Male", "Female"], required: true },
    address: { type: String, required: true }
});

const User = mongoose.model("users", userSchema);
module.exports = User;
```

###  Sample Insert Query

```javascript
db.users.insertOne({
    first_name: "John",
    last_name: "Doe",
    email: "john.doe@example.com",
    mobile: 9876543210,
    dob: ISODate("1990-05-15"),
    age: 33,
    gender: "Male",
    address: "123, ABC Street, New York"
});
```

---

## 2️ **Passports Collection**

###  Schema Definition

```javascript
const mongoose = require('mongoose');

const passportSchema = new mongoose.Schema({
    passportNumber: { type: String, required: true, unique: true },
    issue_date: { type: Date, required: true },
    expiry_date: { type: Date, required: true },
    passport_type: { type: String, enum: ["normal", "tatkal"], required: true },
    amount: { type: Number, required: true },
    issued_kendra: { type: String, required: true },
    user_id: { type: mongoose.Schema.Types.ObjectId, ref: "users" } // Foreign Key Reference
});

const Passport = mongoose.model("passports", passportSchema);
module.exports = Passport;
```

###  Sample Insert Query

```javascript
db.passports.insertOne({
    passportNumber: "U1141650",
    issue_date: ISODate("2017-07-18"),
    expiry_date: ISODate("2033-03-01"),
    passport_type: "tatkal",
    amount: 5000,
    issued_kendra: "Chennai",
    user_id: ObjectId("60f7d1e46a2f3c3b8c4b9b90") // User reference
});
```

---

## 3️ **Logins Collection**

###  Schema Definition

```javascript
const mongoose = require('mongoose');

const loginSchema = new mongoose.Schema({
    email: { type: String, required: true, unique: true },
    password: { type: String, required: true },
    role: { type: String, enum: ["admin", "client"], required: true }
});

const Login = mongoose.model("logins", loginSchema);
module.exports = Login;
```

###  Sample Insert Query

```javascript
db.logins.insertOne({
    email: "admin@example.com",
    password: "hashed_password",
    role: "admin"
});
```

---

##  Sample Queries

###  1. Fetch Users with Passport Details

```javascript
db.users.aggregate([
    {
        $lookup: {
            from: "passports",
            localField: "_id",
            foreignField: "user_id",
            as: "passport_details"
        }
    }
]);
```

---

###  2. Get Passport Count by Kendra

```javascript
db.passports.aggregate([
    {
        $group: {
            _id: "$issued_kendra",
            total_passports: { $sum: 1 }
        }
    },
    { $sort: { total_passports: -1 } }
]);
```

---

###  3. Get Revenue Generated by Each Kendra

```javascript
db.passports.aggregate([
    {
        $group: {
            _id: "$issued_kendra",
            total_revenue: { $sum: "$amount" }
        }
    }
]);
```

---

###  4. Get Top 5 Kendras with Most Tatkal Passports

```javascript
db.passports.aggregate([
    { $match: { passport_type: "tatkal" } },
    {
        $group: {
            _id: "$issued_kendra",
            tatkal_count: { $sum: 1 }
        }
    },
    { $sort: { tatkal_count: -1 } },
    { $limit: 5 }
]);
```

---

##  Indexing for Performance Optimization

To improve **query performance**, add indexes on frequently queried fields:

```javascript
db.passports.createIndex({ issue_date: 1 });
db.passports.createIndex({ issued_kendra: 1 });
db.users.createIndex({ email: 1 });
```

---

##  Notes

- Ensure **MongoDB is running** before executing queries.
- Use **Mongoose models** in the backend to interact with the database.
- Use **hashed passwords** for storing user credentials securely.

---

##  References

For API details, check [API_DOCS.md](API_DOCS.md).

For project setup, refer to [README.md](../README.md).

---
